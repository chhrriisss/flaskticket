{% extends "base.html" %}

{% block title %}Field Configuration - Admin Panel{% endblock %}

{% block content %}
<div class="card" style="box-shadow: 0 4px 20px rgba(0,0,0,0.1); border: none; border-radius: 8px; overflow: hidden; margin-bottom: 24px;">
    <div class="card-header" style="background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%); color: white; padding: 20px 28px; border-radius: 8px 8px 0 0; border: none;">
        <div style="display: flex; align-items: center; gap: 16px;">
            <div>
                <h2 style="margin: 0; font-size: 20px; font-weight: 600; color: white; letter-spacing: -0.3px;">Field Configuration</h2>
            </div>
        </div>
    </div>
    
    <div class="card-body" style="padding: 28px;">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-info" style="padding: 16px 20px; margin-bottom: 28px; border: none; border-left: 4px solid #17a2b8; border-radius: 6px; background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%); box-shadow: 0 2px 8px rgba(23,162,184,0.15);">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Add New Field Card -->
        <div class="card mb-4" style="box-shadow: 0 2px 12px rgba(0,0,0,0.08); border: none; border-radius: 8px; margin-bottom: 28px;">
            <div class="card-header" style="background: linear-gradient(135deg, #28a745 0%, #20873a 100%); color: white; padding: 16px 20px; border-radius: 8px 8px 0 0; border: none;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: white;">Add New Field</h3>
                </div>
            </div>
            <div class="card-body" style="padding: 24px;">
                <form method="POST" action="{{ url_for('update_field_config') }}">
                    <fieldset class="field-group" style="background: linear-gradient(135deg, #fafbfc 0%, #f5f7fa 100%); border: 2px solid #e0e4e8; padding: 24px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 600; font-size: 13px; color: #2c3e50; margin-bottom: 8px; display: block;">Field Name</label>
                                    <input type="text" name="field_name" class="form-control" 
                                           placeholder="e.g., customer_name"
                                           style="padding: 12px 16px; font-size: 13px; border: 2px solid #e8ecef; border-radius: 8px; background: white; transition: all 0.2s ease;"
                                           onfocus="this.style.borderColor='#0066cc'; this.style.boxShadow='0 0 0 4px rgba(0,102,204,0.1)'"
                                           onblur="this.style.borderColor='#e8ecef'; this.style.boxShadow='none'">
                                    <small style="color: #6c757d; font-size: 11px; display: block; margin-top: 6px;">Use lowercase with underscores</small>
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 600; font-size: 13px; color: #2c3e50; margin-bottom: 8px; display: block;">Label</label>
                                    <input type="text" name="field_label" class="form-control" required 
                                           placeholder="e.g., Customer Name"
                                           style="padding: 12px 16px; font-size: 13px; border: 2px solid #e8ecef; border-radius: 8px; background: white; transition: all 0.2s ease;"
                                           onfocus="this.style.borderColor='#0066cc'; this.style.boxShadow='0 0 0 4px rgba(0,102,204,0.1)'"
                                           onblur="this.style.borderColor='#e8ecef'; this.style.boxShadow='none'">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 600; font-size: 13px; color: #2c3e50; margin-bottom: 8px; display: block;">Type</label>
                                    <select name="field_type" class="form-control" id="fieldType" required
                                            style="padding: 12px 16px; font-size: 13px; border: 2px solid #e8ecef; border-radius: 8px; background: white; transition: all 0.2s ease; cursor: pointer;"
                                            onfocus="this.style.borderColor='#0066cc'; this.style.boxShadow='0 0 0 4px rgba(0,102,204,0.1)'"
                                            onblur="this.style.borderColor='#e8ecef'; this.style.boxShadow='none'">
                                        <option value="text">Text</option>
                                        <option value="date">Date</option>
                                        <option value="dropdown">Dropdown</option>
                                        <option value="multiselect">Multi-select</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-col" id="optionsDiv" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 600; font-size: 13px; color: #2c3e50; margin-bottom: 8px; display: block;">Options (comma-separated)</label>
                                    <input type="text" name="options" class="form-control" 
                                           placeholder="Option1, Option2, Option3"
                                           style="padding: 12px 16px; font-size: 13px; border: 2px solid #e8ecef; border-radius: 8px; background: white; transition: all 0.2s ease;"
                                           onfocus="this.style.borderColor='#0066cc'; this.style.boxShadow='0 0 0 4px rgba(0,102,204,0.1)'"
                                           onblur="this.style.borderColor='#e8ecef'; this.style.boxShadow='none'">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 0;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 12px 16px; background: white; border: 2px solid #e8ecef; border-radius: 8px; transition: all 0.2s;"
                                   onmouseover="this.style.borderColor='#0066cc'; this.style.boxShadow='0 2px 8px rgba(0,102,204,0.1)'"
                                   onmouseout="this.style.borderColor='#e8ecef'; this.style.boxShadow='none'">
                                <input type="checkbox" name="editable" checked style="width: 18px; height: 18px; cursor: pointer; accent-color: #0066cc;">
                                <span style="font-size: 13px; color: #2c3e50; font-weight: 500;">Editable by users</span>
                            </label>
                        </div>
                    </fieldset>
                    
                    <div class="form-group text-right" style="margin-top: 24px; padding-top: 20px; border-top: 2px solid #e8ecef; margin-bottom: 0;">
                        <button type="submit" class="btn btn-success" style="padding: 12px 32px; font-size: 14px; font-weight: 600; border-radius: 6px; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);">Add Field</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Configured Fields Card -->
        <div class="card" style="box-shadow: 0 2px 12px rgba(0,0,0,0.08); border: none; border-radius: 8px;">
            <div class="card-header" style="background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%); color: white; padding: 16px 20px; border-radius: 8px 8px 0 0; border: none;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: white;">Configured Fields</h3>
                </div>
            </div>
                
            <div class="table-responsive" style="padding: 0;">
                <table class="table table-hover table-bordered" style="margin-bottom: 0;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                            <th style="padding: 16px 20px; font-size: 12px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6;">Field Name</th>
                            <th style="padding: 16px 20px; font-size: 12px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6;">Label</th>
                            <th style="padding: 16px 20px; font-size: 12px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6;">Type</th>
                            <th style="padding: 16px 20px; font-size: 12px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6;">Editable</th>
                            <th style="padding: 16px 20px; font-size: 12px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6;">Options</th>
                            <th style="padding: 16px 20px; font-size: 12px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6;">Actions</th>
                            <th style="padding: 16px 20px; font-size: 12px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6;">Permissions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for field_name, field_config in config.fields.items() %}
                        <tr style="border-bottom: 1px solid #e8ecef; transition: all 0.2s ease;" 
                            onmouseover="this.style.backgroundColor='#f0f7ff'" 
                            onmouseout="this.style.backgroundColor=''">
                            <td style="padding: 18px 20px; vertical-align: middle;">
                                <strong style="color: #0066cc; font-weight: 600; font-size: 13px;">{{ field_name }}</strong>
                            </td>
                            <td style="padding: 18px 20px; vertical-align: middle; font-size: 13px; color: #495057;">
                                {{ field_config.label }}
                            </td>
                            <td style="padding: 18px 20px; vertical-align: middle;">
                                <span class="badge bg-info" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); color: white; padding: 6px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; display: inline-block;">{{ field_config.type }}</span>
                            </td>
                            <td style="padding: 18px 20px; vertical-align: middle;">
                                {% if field_config.editable %}
                                    <span class="badge bg-success" style="background: linear-gradient(135deg, #28a745 0%, #20873a 100%); color: white; padding: 6px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; display: inline-block;">Yes</span>
                                {% else %}
                                    <span class="badge bg-secondary" style="background: linear-gradient(135deg, #6c757d 0%, #545b62 100%); color: white; padding: 6px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; display: inline-block;">No</span>
                                {% endif %}
                            </td>
                            <td style="padding: 18px 20px; vertical-align: middle; font-size: 12px; color: #6c757d;">
                                {% if field_config.options %}
                                    {{ field_config.options|join(', ') }}
                                {% else %}
                                    <span style="font-style: italic; color: #adb5bd;">-</span>
                                {% endif %}
                            </td>
                            <td style="padding: 18px 20px; vertical-align: middle;">
                                <div style="display: flex; gap: 6px;">
                                    <a href="{{ url_for('edit_field_config', field_name=field_name) }}" 
                                       class="btn btn-sm btn-primary"
                                       style="padding: 6px 14px; font-size: 12px; font-weight: 600; border-radius: 6px; text-decoration: none; transition: all 0.2s;">
                                        Edit
                                    </a>
                                    <a href="{{ url_for('delete_field_config', field_name=field_name) }}" 
                                       class="btn btn-sm btn-danger" 
                                       style="padding: 6px 14px; font-size: 12px; font-weight: 600; border-radius: 6px; text-decoration: none; transition: all 0.2s;"
                                       onclick="return confirm('Are you sure you want to delete this field?')">
                                        Delete
                                    </a>
                                </div>
                            </td>
                            <td style="padding: 18px 20px; vertical-align: middle;">
                                <a href="{{ url_for('admin_field_permissions', field_name=field_name) }}" 
                                   class="btn btn-sm btn-success"
                                   style="padding: 6px 14px; font-size: 12px; font-weight: 600; border-radius: 6px; text-decoration: none; transition: all 0.2s; white-space: nowrap;">
                                    Permissions
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('fieldType').addEventListener('change', function() {
    const optionsDiv = document.getElementById('optionsDiv');
    if (this.value === 'dropdown' || this.value === 'multiselect') {
        optionsDiv.style.display = 'block';
    } else {
        optionsDiv.style.display = 'none';
    }
});
</script>
{% endblock %}