{% extends "base.html" %}

{% block title %}Field Permissions - {{ field_name }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>Field Permissions: {{ field_config.label }} ({{ field_name }})</h2>
    </div>
    <div class="card-body">
        <div class="alert alert-info">
            <strong>Configure who can read, edit, and delete this field.</strong><br>
        </div>
        
        <form method="POST">
            <table class="table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Role</th>
                        <th style="text-align: center;">Read</th>
                        <th style="text-align: center;">Write (Edit)</th>
                        <th style="text-align: center;">Delete</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr {% if user.role == 'admin' %}style="background-color: #f0f0f0;"{% endif %}>
                        <td>
                            <strong>{{ user.name }}</strong><br>
                            <small style="color: #666;">{{ user.username }}</small>
                        </td>
                        <td>
                            <span class="{% if user.role == 'admin' %}status-completed{% else %}status-ongoing{% endif %}">
                                {{ user.role|title }}
                            </span>
                        </td>
                        <td style="text-align: center;">
                            <input type="checkbox" name="read_{{ user.username }}" value="1"
                                   {% if user.role == 'admin' or current_permissions.get(user.username, {}).get('read', False) %}checked{% endif %}
                                   {% if user.role == 'admin' %}disabled{% endif %}>
                        </td>
                        <td style="text-align: center;">
                            <input type="checkbox" name="write_{{ user.username }}" value="1"
                                   {% if user.role == 'admin' or current_permissions.get(user.username, {}).get('write', False) %}checked{% endif %}
                                   {% if user.role == 'admin' %}disabled{% endif %}>
                        </td>
                        <td style="text-align: center;">
                            <input type="checkbox" name="delete_{{ user.username }}" value="1"
                                   {% if user.role == 'admin' or current_permissions.get(user.username, {}).get('delete', False) %}checked{% endif %}
                                   {% if user.role == 'admin' %}disabled{% endif %}>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <div class="alert alert-info">
                <strong>Note:</strong> Admin users always have full permissions and cannot be modified.
            </div>
            
            <div class="form-group text-right mt-3">
                <a href="{{ url_for('admin_config') }}" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">Save Permissions</button>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Current Field Configuration</h3>
    </div>
    <div class="card-body">
        <div class="form-row">
            <div class="form-col">
                <strong>Field Name:</strong> <code>{{ field_name }}</code><br>
                <strong>Label:</strong> {{ field_config.label }}<br>
                <strong>Type:</strong> <span class="status-ongoing">{{ field_config.type|title }}</span>
            </div>
            <div class="form-col">
                <strong>Options:</strong> 
                {% if field_config.get('options') %}
                {{ field_config.options|join(', ') }}
                {% else %}
                <span style="color: #999;">None</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}