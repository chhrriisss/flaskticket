{% extends "base.html" %}

{% block title %}Permission Management - Ticketing Tool{% endblock %}

{% block content %}
<div class="card" style="box-shadow: 0 4px 20px rgba(0,0,0,0.1); border: none; border-radius: 8px; overflow: hidden; margin-bottom: 24px;">
    <div class="card-header" style="background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%); color: white; padding: 20px 28px; border-radius: 8px 8px 0 0; border: none;">
        <div style="display: flex; align-items: center; gap: 16px;">
            <div>
                <h2 style="margin: 0; font-size: 20px; font-weight: 600; color: white; letter-spacing: -0.3px;">Permission Management</h2>
            </div>
        </div>
    </div>
    
    <div class="card-body" style="padding: 28px;">
        <div class="alert alert-info" style="padding: 16px 20px; margin-bottom: 28px; border: none; border-left: 4px solid #17a2b8; border-radius: 6px; background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%); box-shadow: 0 2px 8px rgba(23,162,184,0.15);">
            <strong style="color: #0c5460; font-size: 14px;">ℹ️ Note:</strong> 
            <span style="color: #0c5460; font-size: 13px;">Admin always has all permissions. Unchecked permissions will prevent users from performing those actions.</span>
        </div>
        
        <form method="POST">
            <div style="overflow-x: auto; border: 2px solid #e8ecef; border-radius: 8px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
                <table class="table" style="margin-bottom: 0;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                            <th style="padding: 18px 24px; font-size: 13px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6;">User</th>
                            <th style="padding: 18px 24px; font-size: 13px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6; text-align: center; width: 120px;">Role</th>
                            <th style="padding: 18px 24px; font-size: 13px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6; text-align: center; width: 100px;">
                                <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                                    <span>Create</span>
                                </div>
                            </th>
                            <th style="padding: 18px 24px; font-size: 13px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6; text-align: center; width: 100px;">
                                <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                                    <span>Read</span>
                                </div>
                            </th>
                            <th style="padding: 18px 24px; font-size: 13px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6; text-align: center; width: 100px;">
                                <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                                    <span>Update</span>
                                </div>
                            </th>
                            <th style="padding: 18px 24px; font-size: 13px; font-weight: 700; color: #495057; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #dee2e6; text-align: center; width: 100px;">
                                <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                                    <span>Delete</span>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for username, user_data in users.items() %}
                        {% if username != 'admin' %}
                        <tr style="border-bottom: 1px solid #e8ecef; transition: all 0.2s ease;" 
                            onmouseover="this.style.backgroundColor='#f0f7ff'" 
                            onmouseout="this.style.backgroundColor=''">
                            <td style="padding: 20px 24px; vertical-align: middle;">
                                <div style="display: flex; flex-direction: column; gap: 4px;">
                                    <strong style="font-size: 14px; color: #2c3e50;">{{ user_data.name }}</strong>
                                    <small style="color: #6c757d; font-size: 12px;">@{{ username }}</small>
                                </div>
                            </td>
                            <td style="padding: 20px 24px; text-align: center; vertical-align: middle;">
                                <span class="status-ongoing" style="padding: 6px 14px; font-size: 11px; font-weight: 600; border-radius: 16px; display: inline-block; letter-spacing: 0.3px;">
                                    {{ user_data.role|title }}
                                </span>
                            </td>
                            <td style="padding: 20px 24px; text-align: center; vertical-align: middle;">
                                <label style="margin: 0; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; transition: all 0.2s;"
                                       onmouseover="this.style.backgroundColor='#d4edda'"
                                       onmouseout="this.style.backgroundColor=''">
                                    <input type="checkbox" name="create_{{ username }}" 
                                        style="width: 20px; height: 20px; cursor: pointer; accent-color: #0066cc;"
                                        {% if user_data.get('permissions', {}).get('package_create', False) %}checked{% endif %}>
                                </label>
                            </td>
                            <td style="padding: 20px 24px; text-align: center; vertical-align: middle;">
                                <label style="margin: 0; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; transition: all 0.2s;"
                                       onmouseover="this.style.backgroundColor='#d1ecf1'"
                                       onmouseout="this.style.backgroundColor=''">
                                    <input type="checkbox" name="read_{{ username }}" 
                                        style="width: 20px; height: 20px; cursor: pointer; accent-color: #0066cc;"
                                        {% if user_data.get('permissions', {}).get('package_read', False) %}checked{% endif %}>
                                </label>
                            </td>
                            <td style="padding: 20px 24px; text-align: center; vertical-align: middle;">
                                <label style="margin: 0; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; transition: all 0.2s;"
                                       onmouseover="this.style.backgroundColor='#cce5ff'"
                                       onmouseout="this.style.backgroundColor=''">
                                    <input type="checkbox" name="update_{{ username }}" 
                                        style="width: 20px; height: 20px; cursor: pointer; accent-color: #0066cc;"
                                        {% if user_data.get('permissions', {}).get('package_update', False) %}checked{% endif %}>
                                </label>
                            </td>
                            <td style="padding: 20px 24px; text-align: center; vertical-align: middle;">
                                <label style="margin: 0; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; transition: all 0.2s;"
                                       onmouseover="this.style.backgroundColor='#f8d7da'"
                                       onmouseout="this.style.backgroundColor=''">
                                    <input type="checkbox" name="delete_{{ username }}" 
                                        style="width: 20px; height: 20px; cursor: pointer; accent-color: #dc3545;"
                                        {% if user_data.get('permissions', {}).get('package_delete', False) %}checked{% endif %}>
                                </label>
                            </td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                        
                        <!-- Admin row (read-only) -->
                        <tr style="background: linear-gradient(135deg, #f0f7ff 0%, #e8f4ff 100%); border-left: 4px solid #17a2b8;">
                            <td style="padding: 20px 24px; vertical-align: middle;">
                                <div style="display: flex; flex-direction: column; gap: 4px;">
                                    <strong style="font-size: 14px; color: #2c3e50;">{{ users.admin.name }}</strong>
                                    <small style="color: #6c757d; font-size: 12px;">@admin</small>
                                </div>
                            </td>
                            <td style="padding: 20px 24px; text-align: center; vertical-align: middle;">
                                <span class="status-completed" style="padding: 6px 14px; font-size: 11px; font-weight: 600; border-radius: 16px; display: inline-block; letter-spacing: 0.3px;">Admin</span>
                            </td>
                            <td style="padding: 20px 24px; text-align: center; vertical-align: middle;">
                                <label style="margin: 0; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; background: #d4edda;">
                                    <input type="checkbox" checked disabled style="width: 20px; height: 20px; accent-color: #0066cc;">
                                </label>
                            </td>
                            <td style="padding: 20px 24px; text-align: center; vertical-align: middle;">
                                <label style="margin: 0; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; background: #d1ecf1;">
                                    <input type="checkbox" checked disabled style="width: 20px; height: 20px; accent-color: #0066cc;">
                                </label>
                            </td>
                            <td style="padding: 20px 24px; text-align: center; vertical-align: middle;">
                                <label style="margin: 0; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; background: #cce5ff;">
                                    <input type="checkbox" checked disabled style="width: 20px; height: 20px; accent-color: #0066cc;">
                                </label>
                            </td>
                            <td style="padding: 20px 24px; text-align: center; vertical-align: middle;">
                                <label style="margin: 0; display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; background: #f8d7da;">
                                    <input type="checkbox" checked disabled style="width: 20px; height: 20px; accent-color: #dc3545;">
                                </label>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 32px; padding-top: 24px; border-top: 2px solid #e8ecef; text-align: right; display: flex; justify-content: flex-end; gap: 12px;">
                <a href="{{ url_for('admin_panel') }}" 
                   class="btn btn-secondary" 
                   style="padding: 12px 28px; font-size: 14px; font-weight: 600; border-radius: 6px; text-decoration: none; transition: all 0.2s ease;">
                   Cancel
                </a>
                <button type="submit" 
                        class="btn btn-success" 
                        style="padding: 12px 32px; font-size: 14px; font-weight: 600; border-radius: 6px; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3); transition: all 0.2s ease;">
                    Save Permissions
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}